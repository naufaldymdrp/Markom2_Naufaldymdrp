@page "{handler?}"
@model Markom2.Web.Pages.Master.MCompanyModel
@{
}

<div class="row">
    <div class="col-sm">
        <!-- BreadCrumb Navigation -->
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">Home</li>
                <li class="breadcrumb-item">Master</li>
                <li class="breadcrumb-item active" aria-current="page">Master Company</li>
            </ol>
        </nav>
        <hr />
        <!-- /BreadCrumb Navigation -->
        <h4>Company Master Data</h4>
        <div class="row">
            <div class="col-sm d-flex flex-row-reverse">
                <a href="#" id="AddCompanyModalButton" class="btn btn-primary">Add</a>
            </div>
        </div>
        <div class="row">
            <div class="col-sm">

            </div>
        </div>
        <br />
        <table class="table">
            <thead>
                <tr>
                    <th>@Html.DisplayNameFor(item => item.Companies[0].Id)</th>
                    <th>@Html.DisplayNameFor(item => item.Companies[0].Code)</th>
                    <th>@Html.DisplayNameFor(item => item.Companies[0].Name)</th>                                       
                    <th>@Html.DisplayNameFor(item => item.Companies[0].CreatedDate)</th>
                    <th>Created By</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                @if (Model.Companies != null)
                {
                    @foreach (var modelItem in Model.Companies)
                    {
                        <tr>
                            <td>@Html.DisplayFor(_ => modelItem.Id)</td>
                            <td>@Html.DisplayFor(_ => modelItem.Code)</td>
                            <td>@Html.DisplayFor(_ => modelItem.Name)</td>
                            <td>@Html.DisplayFor(_ => modelItem.CreatedDate)</td>
                            <td>@Html.DisplayFor(_ => modelItem.CreatedBy_Navigation.UserName)</td>
                            <td>Klik</td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>
</div>

@section Scripts
{
    <partial name="_ValidationScriptsPartial" />  
    <script type="text/javascript">

        $(document).ready(() => {
            $("#AddCompanyModalButton").on("click", () => {
                $.ajax({
                    url: "MCompany/AddMCompanyPartial",
                    accepts: "text/html",
                    success: e => {
                        $("#ModalContent").append(e);
                        $("form#MCompanyFormPartial").removeData("validator");
                        $("form#MCompanyFormPartial").removeData("unobtrusiveValidation");
                        $.validator.unobtrusive.parse("form#MCompanyFormPartial");
                    },
                    error: err => {
                        var errDetailJson = err.responseJson;
                        $("#ModalContent").append(errDetailJson);
                    }
                });
                
                showModal();
            });

            $(document).on("submit", "#MCompanyFormPartial", (ev) => {
                ev.preventDefault();
                //debugger;



                //$.validator.unobtrusive.parse("form#MCompanyFormPartial");
                let formValue = $("#MCompanyFormPartial").serialize();
                //console.log(formValue);
                if (formValue != undefined) {
                    $.post("MCompany/AddMCompany", formValue, (resData) => {
                        //debugger;
                        console.log("sukses");
                        console.log(resData);
                        closeModal();
                    }).fail(data => {
                        //debugger;
                        console.log("gagal");
                        console.log(data.responseText);
                    }).done(() => {
                        $.get("MCompany");
                    });
                }
            });

            $(document).on("click", "#MCompanyModalCloser", () => {
                closeModal();
            });


        });
    </script>  

}